# Шахматный бот
Курсовой проект за второй курс, шахматный бот для шахмат со сложной очередью.


## Сложная очередь, целевые правила
+ Начальная расстановка фигур практически любая.
+ Пешки не могут стоять на горизонталях 1 и 8, могут превращаться в королей.
+ Количество фигур не отграничено, может быть 5 чёрных слонов и 4 белых короля.
+ Шахов и патов нет.
+ Взятие на проходе есть, можно только следующим ходом.
+ Рокировка возможна, если К и Л на своих местах.
+ Цель: съесть $k$ королей соперника.

Замечание: мне не очевидно, что такое рокировка при большом количество К и Л, поэтому пока её не будет.


## Короткая документация
+ Список названий фигур расположен ниже. Белые фигуры заглавными буквами, чёрные - строчными.

| Русс.  | Англ.  | Короткое |
|--------|--------|----------|
| пешка  | pawn   | p        |
| ладья  | rook   | r        |
| конь   | knight | n        |
| слон   | bishop | b        |
| король | king   | k        |
| ферзь  | queen  | q        |

+ Координаты: пара $(x, y)$, в диапазоне $0 \leq x, y \leq 7$, где $x$ - вертикаль (abcdefgh), $y$ горизонталь (12345678).


## Запись ходов
Поскольку правила несколько отличаются от обычных, то пришлось адаптировать стандартную шахматную нотацию под наши правила:
+ Порядковый номер хода - минимально возможный (например, если после хода белых был ход чёрных, то они получат общий номер, как в стандартных шахматах); отсутствие ходов обозначается `...`.
+ Обозначение фигур стандартное - по таблице выше, для пешек название не пишется. Все фигуры обозначаются заглавными буквами.
+ Обычные ходы записываются по стандартным правилам (ходящая фигур, откуда идёт, символ перехода, куда идёт), для тихих ходов используется `-`, для взятий `x`.
+ Взятие на проходе - по правилам взятия.
+ Длинные ходы пешек - по правилам тихого хода.
+ Превращения пешек - по правилам хода, плюс фигура в которую происходит превращение.
+ Рокировка - при стандартной расстановке как обычно (`0-0` и `0-0-0`), при модификациях как `00_e1_h1`, где `e1` - стартовая позиция короля, `h1` - стартовая позиция ладьи.


## Полезные статьи
+ [Habr - несложные шахматы](https://habr.com/ru/companies/skillbox/articles/437524/);
+ [Habr - разработка шахматной программы](https://habr.com/ru/articles/329528/);
+ [Habr - шахматы на C++](https://habr.com/ru/articles/682122/);
+ [Habr - алгоритм minimax в шахматах](https://habr.com/ru/companies/otus/articles/785512/);
+ [Habr - определяем веса шахматных фигур](https://habr.com/ru/articles/254753/);
+ [Habr - как компьютер играет в шахматы](https://habr.com/ru/articles/390821/);
+ [Таблица оценок позиций](https://www.chessprogramming.org/Simplified_Evaluation_Function);
+ [Википедия - шахматная нотация](https://ru.wikipedia.org/wiki/%D0%A8%D0%B0%D1%85%D0%BC%D0%B0%D1%82%D0%BD%D0%B0%D1%8F_%D0%BD%D0%BE%D1%82%D0%B0%D1%86%D0%B8%D1%8F);


## Сборка
Проект собирается с помощью [CMake файла](./CMakeLists.txt), под C++20. Также должна быть установлена библиотека [SFML](https://www.sfml-dev.org/), используется версия `2.5.1`, но скорее всего можно новее. Для сборки с графическим интерфейсом используйте `make bot_ui`, без него - `make bot`. Для сборки под Windows можно просто запустить `.vscode/compile_cpp.bat`.


## Release сборка
Для release сборки нужно запустить из корня проекта скрипт `.vscode/create_release.bat`. Если в скрипте правильно задан путь до всех dll библиотек, то результатом скрипта будет папка `.release` с исполняемым файлом, всеми необходимыми dll и файлами дизайна (шрифты, картинки, звуки). Также в папке появится архив со всеми этими файлами.

Готовую сборку для Windows можно скачать из [раздела Release на Github](https://github.com/slavashestakov2005/ChessBot/releases).


## Презентация
В презентации используется граф зависимостей между всеми файлами проекта, его можно сгенерировать, запустив `.vscode/deps_graph.sh` из корня проекта -- он сгенерирует файл `.vscode/graph.png` с графом зависимостей.

Также в презентации используется псевдокод Зобрист хеширования, в реальности это делается [подсветкой JavaScript синтаксиса](https://highlight.hohli.com/?language=javascript) для кода:

```js
function init():
    for square from 1 to 64:
        for side from 0 to 1:
            for figure in FIGURES:
                zobrist[square][side][figure] = random_bits()

function zobrist(board):
    hash = 0
    for square from 1 to 64:
        for side from 0 to 1:
            for figure in FIGURES:
                if board[square, side, figure]:
                    hash ^= zobtist[square][side][figure]
    return hash
```
